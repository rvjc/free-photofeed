// Copyright RVJ Callanan 2011 //
function init(){commonInit("home");ERR.setErrHandler(errHandler);gadgets.util.registerOnLoadHandler(loadHandler);}function errHandler(){if(CFG.state!==CON.cfgStates.initialising){gel('content').innerHTML=htmlMsg(ERR.text());}}function loadHandler(){CFG=new Cfg();CFG.init(cfgReadyHandler);}function cfgReadyHandler(){var e=gel('content');if(CFG.state===CON.cfgStates.errored){e.innerHTML=htmlMsg(CFG.error);throw CFG.error;}e.style.padding=CFG.padding+'px';e.style.width=DOC.width-2*CFG.padding;e.style.textAlign=CON.aligns.nameOf(CFG.align);SRC=new Src();CAB=new Cab();CAB.init(cabReadyHandler);}function cabReadyHandler(){var leadIndex;var selOptions;if(CAB.state===CON.cabStates.errored){gel('content').innerHTML=htmlMsg(CAB.error);throw CAB.error;}if(CAB.items.length===0){ERR.WEB("Empty Photo Cabinet",CAB.webUrl());}leadIndex=CAB.match(CFG.leadPhotoName);if(leadIndex<0){leadIndex=0;}selOptions={};SEL=new Sel("content",leadIndex,'A',selOptions,selReadyHandler,selClickHandler);SEL.show();}function selReadyHandler(){gadgets.window.adjustHeight(DOC.height);}function selClickHandler(index){var shoOptions;if(CFG.noSlides){window.open(CAB.items[index].cabSrc(),this.options.linkNew?'_blank':'_top');}else{SEL.close();SEL=null;shoOptions={};SHO=new Sho("content",index,shoOptions,shoMoveHandler,shoCloseHandler);SHO.show();}}function shoMoveHandler(){gadgets.window.adjustHeight();}function shoCloseHandler(){SHO=null;cabReadyHandler();}init();